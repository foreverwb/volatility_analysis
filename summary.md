期权策略量化分析系统 (v2.1) - 完整逻辑白皮书

本文档详细定义了 app.py 中实现的期权数据分析、评分模型、策略生成及风控逻辑。该系统基于“量价结构”与“波动率偏度”双重驱动，将标的资产划分为四个象限。

一、输入数据与字段定义

1. 必需字段

标的代码 (symbol)

当日价格变动 (PriceChgPct): 如 "+3.4%" 或 -0.8

隐含波动率 (IV30): 30天隐含波动率

IV变动 (IV30ChgPct): 如 "+6.4%" (关键字段，用于价-波相关性)

历史波动率 (HV20, HV1Y): 20天/1年历史波动率

IV Rank (IVR): 0-100

成交量 (Volume)

Open Interest %Rank (OI_PctRank)

财报日期 (Earnings): 用于事件驱动判断

2. 可选/高级字段

IV90: 90天隐含波动率（用于计算期限结构，v2.1新增）

资金流数据:

RelVolTo90D (相对成交量)

Call/Put Volume, Call/Put Notional

Put%

结构占比: SingleLeg% (单腿), MultiLeg% (多腿), Contingent% (与股票联动)

二、数据清洗与预处理 (v2.1 增强)

系统会自动处理各种格式的输入数据，确保计算稳定性：

百分比: 自动去除 %, + 并转换为浮点数（如 +6.4% -> 6.4）。

数值: 自动去除逗号（如 1,234 -> 1234.0）。

单位: 自动识别 K, M, B 后缀并转换为完整数值（如 1.2 M -> 1,200,000）。

缺失值: 关键计算中缺失值默认为 0.0 或 1.0（视语境而定）。

三、高级量化指标 (v2.1 新增核心)

1. 动态阈值配置 (Index vs Equity)

为了解决指数（SPY/QQQ）天然 Put 偏多的问题，系统采用双轨制阈值：

阈值项

个股标准 (Equity)

指数标准 (Index/ETF)

逻辑说明

Put% 偏空线

$\ge 55\%$

$\ge 65\%$

指数天然有对冲 Put，需更高比例才算看空

Put% 偏多线

$\le 45\%$

$\le 50\%$

指数 Put 少于 50% 已经是强烈看多信号

C/P Ratio 偏多线

$\ge 1.30$

$\ge 1.00$

指数 C/P > 1:1 即视为资金看多

2. 价-波相关性 (Spot-Vol Correlation)

通过价格与 IV 的同步变化来推断市场深层意图（修正单纯看 Put% 的盲区）：

🔥 逼空/动量 (Score +0.4)

条件: PriceChg > 0.5% 且 IVChg > 2.0%

解读: 强劲买盘导致做市商短 Gamma，被迫追涨，典型的 Call Squeeze。

⚠️ 恐慌抛售 (Score -0.5)

条件: PriceChg < -0.5% 且 IVChg > 2.0%

解读: 避险情绪升温，Skew 走陡，机构买 Put 避险，典型的 Crash 模式。

📈 磨涨/稳健 (Score +0.2)

条件: PriceChg > 0% 且 IVChg < -2.0%

解读: 价格上涨伴随 IV 回落，Vanna 支撑，最为健康的慢牛走势。

3. Gamma 挤压预警 (Gamma Squeeze Detector)

检测爆发性行情的潜力。当满足以下所有条件时触发 is_squeeze=True：

期权便宜: IV30 / HV20 < 0.95

仓位拥挤: OI_PctRank > 70

价格启动: PriceChgPct > 1.5%

显著放量: RelVolTo90D > 1.2

4. 期限结构 (Term Structure)

指标: Ratio = IV30 / IV90

📉 倒挂/恐慌: Ratio > 1.1 (近端极贵，通常见于大跌前夕或事件前)

📈 陡峭/正常: Ratio < 0.9 (远端贵，正常的市场结构)

四、核心评分模型详解

1. 方向评分 (Direction Score)

越高越偏多，越低越偏空。

价格与量信号:

涨跌幅：使用 tanh 函数平滑处理，涨幅 $\ge 1\%$ 显著加分。

相对量 (RelVol): $\ge 1.2$ 为放量（加分），$\le 0.8$ 为缩量。

期权多空不平衡:

Call/Put 比值: $\ge 1.3$ (指数 1.0) 偏多；$\le 0.77$ 偏空。

Put%: $\le 45\%$ (指数 50%) 偏多；$\ge 55\%$ (指数 65%) 偏空。

结构可信度调整:

单腿占比高 ($\ge 80\%$)：系数放大 1.1倍（方向更纯粹）。

多腿占比高 ($\ge 25\%$)：系数缩小 0.9倍（对冲属性强）。

股票联动 ($\ge 2\%$)：系数缩小 0.9倍。

修正项: 累加 价-波相关性分数 (-0.5 ~ +0.4)。

2. 波动评分 (Vol Score)

正值代表“买入波动率”，负值代表“卖出波动率”。

相对历史的贵/便宜:

IVR: $\le 30$ 加分（买波）；$\ge 70$ 扣分（卖波）。

IVRV比值: $\le 0.95$ 加分（便宜）；$\ge 1.15$ 扣分（贵）。

边际变化与真实环境:

IV当日变动: $\ge +10\%$ 加分；$\le -10\%$ 扣分。

Regime比值: $\ge 1.2$ 加分（环境躁动）；$\le 0.8$ 扣分（环境平静）。

事件窗口:

财报在 0-14 天内：加分（买波倾向）。0-2天内大幅加分。

恐慌环境卖波:

若 IVR 高 ($\ge 75$) 且溢价高 ($\ge 1.3$) 但真实波动低 (Regime $\le 1.05$)，视为“恐慌溢价”，倾向于做空波动率。

五、流动性与置信度

1. 流动性分级

高: 成交量 $\ge$ 100万 或 名义金额 $\ge$ 3亿 或 OI Rank $\ge$ 60。

中: 成交量 $\ge$ 20万 或 名义金额 $\ge$ 1亿 或 OI Rank $\ge$ 40。

低: 不满足上述条件。

2. 置信度评估 (Confidence)

高: 方向/波动评分绝对值高 ($\ge 1.5$) + 流动性好。

中: 评分适中 + 流动性中等。

低: 数据缺失、流动性差或触发惩罚项。

3. 惩罚项

极端变动低量惩罚: 若价格剧烈波动 (abs $\ge 20\%$) 但成交量未放大 (RelVol $\le 0.8$)，视为流动性缺失导致的假突破，强制降低置信度。

六、四象限映射与策略矩阵

象限

市场状态

核心策略建议

风险提示

偏多—买波

上涨 + 波动率低/升

Long Call / Call Spread



利用低 IV 杠杆或动量爆发

时间损耗，IV回落

偏多—卖波

上涨 + 波动率高/降

Short Put / Put Spread



赚取方向收益同时通过卖波获利

突发利空大跌

偏空—买波

下跌 + 波动率低/升

Long Put / Put Spread



防范恐慌性暴跌 (Crash Protection)

反弹，IV Crush

偏空—卖波

下跌 + 波动率高/降

Bear Call Spread / Iron Condor



阴跌行情，利用 Theta 衰减

逼空风险

特殊状态

Gamma Squeeze

🔥 强烈建议 Long Call



激进追涨，需设置移动止盈

行情快速反转

七、输出内容结构 (API 响应)

每次分析将返回包含以下字段的 JSON 对象：

基础信息: symbol, timestamp

结论: quadrant (四象限), confidence, liquidity

标记: is_squeeze (挤压), is_index (指数类型)

分数: direction_score, vol_score

高级指标:

spot_vol_corr_score (价-波相关性)

term_structure_ratio (期限结构)

解释因子:

direction_factors: ["涨幅 +3.4%", "🔥 逼空/动量", ...]

vol_factors: ["IVR 57%", "📅 财报 5天内", ...]

策略: strategy (具体操作建议), risk (风险点)